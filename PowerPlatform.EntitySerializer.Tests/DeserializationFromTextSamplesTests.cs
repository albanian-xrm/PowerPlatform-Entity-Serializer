using AlbanianXrm.PowerPlatform;
using Microsoft.Xrm.Sdk;
using System;
using Xunit;

namespace EntitySerializerTests
{
    public class DeserializationFromTextSamplesTests
    {
        [Fact]
        public void RemoteExecutionContextCanBeDeserialized_Sample1()
        {
            var input = /*lang=json*/ @"{
""BusinessUnitId"": ""f0bf3c9a-8150-e811-a953-000d3af29fc0"",
""CorrelationId"": ""39499111-e689-42a1-ae8a-5b14a84514ce"",
""Depth"": 1,
""InitiatingUserId"": ""df010dad-f103-4589-ba66-76a5a04c2a11"",
""InputParameters"": [
    {
    ""key"": ""Target"",
    ""value"": {
        ""__type"": ""Entity:http:\/\/schemas.microsoft.com\/xrm\/2011\/Contracts"",
        ""Attributes"": [
        {
            ""key"": ""telephone1"",
            ""value"": ""1111""
        },{
            ""key"": ""accountid"",            ""value"": {""__type"":""Guid:#System"",""__value"":""ec4e2f7d-9d60-e811-a95a-000d3af24950""}          },          {            ""key"": ""modifiedon"",            ""value"": {""__type"":""DateTime:#System"",""__value"":""\/Date(1527757524000)\/""          }},          {            ""key"": ""modifiedby"",            ""value"": {              ""__type"": ""EntityReference:http:\/\/schemas.microsoft.com\/xrm\/2011\/Contracts"",              ""Id"": ""df010dad-f103-4589-ba66-76a5a04c2a11"",              ""KeyAttributes"": [],              ""LogicalName"": ""systemuser"",              ""Name"": null,              ""RowVersion"": null            }          },          {            ""key"": ""modifiedonbehalfby"",            ""value"": null          }        ],        ""EntityState"": null,        ""FormattedValues"": [],        ""Id"": ""ec4e2f7d-9d60-e811-a95a-000d3af24950"",        ""KeyAttributes"": [],        ""LogicalName"": ""account"",        ""RelatedEntities"": [],        ""RowVersion"": null      }    }  ],  ""IsExecutingOffline"": false,  ""IsInTransaction"": true,  ""IsOfflinePlayback"": false,  ""IsolationMode"": 1,  ""MessageName"": ""Update"",  ""Mode"": 0,  ""OperationCreatedOn"": ""\/Date(1527757530151)\/"",  ""OperationId"": ""08fec203-ec78-4f7a-a024-c96e329a64fe"",  ""OrganizationId"": ""b0714265-8e72-4d3b-8239-ecf0970a3da6"",  ""OrganizationName"": ""org94971a24"",  ""OutputParameters"": [],  ""OwningExtension"": {    ""Id"": ""3db800fe-0963-e811-a95a-000d3af24324"",    ""KeyAttributes"": [],    ""LogicalName"": ""sdkmessageprocessingstep"",    ""Name"": ""D365WebHookHttpTrigger: Update of account"",    ""RowVersion"": null  },  ""ParentContext"": {    ""BusinessUnitId"": ""f0bf3c9a-8150-e811-a953-000d3af29fc0"",    ""CorrelationId"": ""39499111-e689-42a1-ae8a-5b14a84514ce"",    ""Depth"": 1,    ""InitiatingUserId"": ""df010dad-f103-4589-ba66-76a5a04c2a11"",    ""InputParameters"": [      {        ""key"": ""Target"",        ""value"": {          ""__type"": ""Entity:http:\/\/schemas.microsoft.com\/xrm\/2011\/Contracts"",          ""Attributes"": [            {              ""key"": ""telephone1"",              ""value"": ""1111""            },            {              ""key"": ""accountid"",              ""value"": ""ec4e2f7d-9d60-e811-a95a-000d3af24950""            }          ],          ""EntityState"": null,          ""FormattedValues"": [],          ""Id"": ""ec4e2f7d-9d60-e811-a95a-000d3af24950"",          ""KeyAttributes"": [],          ""LogicalName"": ""account"",          ""RelatedEntities"": [],          ""RowVersion"": null        }      },      {        ""key"": ""SuppressDuplicateDetection"",        ""value"": false      }    ],    ""IsExecutingOffline"": false,    ""IsInTransaction"": true,    ""IsOfflinePlayback"": false,    ""IsolationMode"": 1,    ""MessageName"": ""Update"",    ""Mode"": 0,    ""OperationCreatedOn"": ""\/Date(1527757524631)\/"",    ""OperationId"": ""08fec203-ec78-4f7a-a024-c96e329a64fe"",    ""OrganizationId"": ""b0714265-8e72-4d3b-8239-ecf0970a3da6"",    ""OrganizationName"": ""org94971a24"",    ""OutputParameters"": [],    ""OwningExtension"": {      ""Id"": ""63cdbb1b-ea3e-db11-86a7-000a3a5473e8"",      ""KeyAttributes"": [],      ""LogicalName"": ""sdkmessageprocessingstep"",      ""Name"": ""ObjectModel Implementation"",      ""RowVersion"": null    },    ""ParentContext"": null,    ""PostEntityImages"": [],    ""PreEntityImages"": [],    ""PrimaryEntityId"": ""ec4e2f7d-9d60-e811-a95a-000d3af24950"",    ""PrimaryEntityName"": ""account"",    ""RequestId"": ""08fec203-ec78-4f7a-a024-c96e329a64fe"",    ""SecondaryEntityName"": ""none"",    ""SharedVariables"": [      {        ""key"": ""ChangedEntityTypes"",        ""value"": [          {            ""__type"": ""KeyValuePairOfstringstring:#System.Collections.Generic"",            ""key"": ""account"",            ""value"": ""Update""          }        ]      }    ],    ""Stage"": 30,    ""UserId"": ""df010dad-f103-4589-ba66-76a5a04c2a11""  },  ""PostEntityImages"": [],  ""PreEntityImages"": [],  ""PrimaryEntityId"": ""ec4e2f7d-9d60-e811-a95a-000d3af24950"",  ""PrimaryEntityName"": ""account"",  ""RequestId"": ""08fec203-ec78-4f7a-a024-c96e329a64fe"",  ""SecondaryEntityName"": ""none"",  ""SharedVariables"": [],  ""Stage"": 40,  ""UserId"": ""df010dad-f103-4589-ba66-76a5a04c2a11""}";
            var remoteExecutionContext = EntitySerializer.Deserialize<RemoteExecutionContext>(input);

            Assert.NotNull(remoteExecutionContext);
            Assert.Equal(Guid.Parse("f0bf3c9a-8150-e811-a953-000d3af29fc0"), remoteExecutionContext.BusinessUnitId);
            Assert.Equal(Guid.Parse("39499111-e689-42a1-ae8a-5b14a84514ce"), remoteExecutionContext.CorrelationId);
            Assert.Equal(1, remoteExecutionContext.Depth);
            Assert.Equal(Guid.Parse("df010dad-f103-4589-ba66-76a5a04c2a11"), remoteExecutionContext.InitiatingUserId);
            
        }

        [Fact]
        public void RemoteExecutionContextCanBeDeserialized_Sample2()
        {
            var input = @"{""BusinessUnitId"":""c3ec0cc2-d836-eb11-bf68-0022489b563d"", ""CorrelationId"":""9d4c7524-a578-4783-b608-73f7b0b68fd2"", ""Depth"":1, ""InitiatingUserAzureActiveDirectoryObjectId"":""00000000-0000-0000-0000-000000000000"", ""InitiatingUserId"":""a0bde583-0537-eb11-bf68-0022489b563d"", ""InputParameters"":[{""key"":""Target"",""value"":{""__type"":""Entity:http:\/\/schemas.microsoft.com\/xrm\/2011\/Contracts"",""Attributes"":[{""key"":""albxrm_twooptions"",""value"":true},{""key"":""albxrm_lookupaccount"",""value"":{""__type"":""EntityReference:http:\/\/schemas.microsoft.com\/xrm\/2011\/Contracts"",""Id"":""b76b3f4b-1be7-e611-8101-e0071b6af231"",""KeyAttributes"":[],""LogicalName"":""account"",""Name"":null,""RowVersion"":null}},{ ""key"":""albxrm_wholenumber"",""value"":987654321},{ ""key"":""owningbusinessunit"",""value"":{ ""__type"":""EntityReference:http:\/\/schemas.microsoft.com\/xrm\/2011\/Contracts"",""Id"":""c3ec0cc2-d836-eb11-bf68-0022489b563d"",""KeyAttributes"":[],""LogicalName"":""businessunit"",""Name"":null,""RowVersion"":null} },{ ""key"":""modifiedon"",""value"":""\/Date(1608007658000)\/""},{ ""key"":""albxrm_name"",""value"":""Test Betim""},{ ""key"":""albxrm_multiplelinesoftext"",""value"":""sdafasf\u000aasdfas\u000aafsd""},{ ""key"":""ownerid"",""value"":{ ""__type"":""EntityReference:http:\/\/schemas.microsoft.com\/xrm\/2011\/Contracts"",""Id"":""a0bde583-0537-eb11-bf68-0022489b563d"",""KeyAttributes"":[],""LogicalName"":""systemuser"",""Name"":null,""RowVersion"":null} },{ ""key"":""createdby"",""value"":{ ""__type"":""EntityReference:http:\/\/schemas.microsoft.com\/xrm\/2011\/Contracts"",""Id"":""a0bde583-0537-eb11-bf68-0022489b563d"",""KeyAttributes"":[],""LogicalName"":""systemuser"",""Name"":null,""RowVersion"":null} },{ ""key"":""albxrm_customer"",""value"":{ ""__type"":""EntityReference:http:\/\/schemas.microsoft.com\/xrm\/2011\/Contracts"",""Id"":""ad6b3f4b-1be7-e611-8101-e0071b6af231"",""KeyAttributes"":[],""LogicalName"":""account"",""Name"":null,""RowVersion"":null} },{ ""key"":""albxrm_alltypesid"",""value"":""44bfc2a7-903e-eb11-a813-000d3ad9c2e1""},{ ""key"":""timezoneruleversionnumber"",""value"":0},{ ""key"":""transactioncurrencyid"",""value"":{ ""__type"":""EntityReference:http:\/\/schemas.microsoft.com\/xrm\/2011\/Contracts"",""Id"":""083081e1-0737-eb11-bf68-0022489b563d"",""KeyAttributes"":[],""LogicalName"":""transactioncurrency"",""Name"":null,""RowVersion"":null} },{ ""key"":""modifiedonbehalfby"",""value"":null},{ ""key"":""albxrm_currency"",""value"":{ ""__type"":""Money:http:\/\/schemas.microsoft.com\/xrm\/2011\/Contracts"",""Value"":2154.32} },{ ""key"":""albxrm_optionset"",""value"":{ ""__type"":""OptionSetValue:http:\/\/schemas.microsoft.com\/xrm\/2011\/Contracts"",""Value"":257760001} },{ ""key"":""albxrm_multiselectoptionset"",""value"":[{ ""__type"":""OptionSetValue:http:\/\/schemas.microsoft.com\/xrm\/2011\/Contracts"",""Value"":257760001},{ ""__type"":""OptionSetValue:http:\/\/schemas.microsoft.com\/xrm\/2011\/Contracts"",""Value"":257760002}]},{ ""key"":""albxrm_float"",""value"":2365.12},{ ""key"":""modifiedby"",""value"":{ ""__type"":""EntityReference:http:\/\/schemas.microsoft.com\/xrm\/2011\/Contracts"",""Id"":""a0bde583-0537-eb11-bf68-0022489b563d"",""KeyAttributes"":[],""LogicalName"":""systemuser"",""Name"":null,""RowVersion"":null} },{ ""key"":""albxrm_dateandtime"",""value"":""\/Date(1608015600000)\/""},{ ""key"":""createdon"",""value"":""\/Date(1608007658000)\/""},{ ""key"":""statecode"",""value"":{ ""__type"":""OptionSetValue:http:\/\/schemas.microsoft.com\/xrm\/2011\/Contracts"",""Value"":0} },{ ""key"":""statuscode"",""value"":{ ""__type"":""OptionSetValue:http:\/\/schemas.microsoft.com\/xrm\/2011\/Contracts"",""Value"":1} },{ ""key"":""albxrm_decimal"",""value"":10.01},{ ""key"":""exchangerate"",""value"":1.0000000000},{ ""key"":""albxrm_currency_base"",""value"":{ ""__type"":""Money:http:\/\/schemas.microsoft.com\/xrm\/2011\/Contracts"",""Value"":2154.32} }],""EntityState"":null,""FormattedValues"":[{""key"":""albxrm_twooptions"",""value"":""Yes""},{ ""key"":""albxrm_wholenumber"",""value"":""987,654,321""},{ ""key"":""modifiedon"",""value"":""2020-12-15T05:47:38+01:00""},{ ""key"":""timezoneruleversionnumber"",""value"":""0""},{ ""key"":""albxrm_currency"",""value"":""Ã¢âÂ¬2,154.32""},{ ""key"":""albxrm_optionset"",""value"":""Value 2""},{ ""key"":""albxrm_multiselectoptionset"",""value"":""Value 1; Value 2""},{ ""key"":""albxrm_float"",""value"":""2,365.12""},{ ""key"":""albxrm_dateandtime"",""value"":""2020-12-15T08:00:00+01:00""},{ ""key"":""createdon"",""value"":""2020-12-15T05:47:38+01:00""},{ ""key"":""statecode"",""value"":""Active""},{ ""key"":""statuscode"",""value"":""Active""},{ ""key"":""albxrm_decimal"",""value"":""10.01""}],""Id"":""44bfc2a7-903e-eb11-a813-000d3ad9c2e1"",""KeyAttributes"":[],""LogicalName"":""albxrm_alltypes"",""RelatedEntities"":[],""RowVersion"":null}}],""IsExecutingOffline"":false,""IsInTransaction"":false,""IsOfflinePlayback"":false,""IsolationMode"":1,""MessageName"":""Create"",""Mode"":1,""OperationCreatedOn"":""\/Date(1608007658000+0000)\/"",""OperationId"":""45bfc2a7-903e-eb11-a813-000d3ad9c2e1"",""OrganizationId"":""0ba4ce62-d2d6-4681-bc25-b3bfb695d4d6"",""OrganizationName"":""0ba4ce62d2d64681bc25b3bfb695d4d6"",""OutputParameters"":[{""key"":""id"",""value"":""44bfc2a7-903e-eb11-a813-000d3ad9c2e1""}],""OwningExtension"":{ ""Id"":""2c28fe56-903e-eb11-a813-000d3ad9c2e1"",""KeyAttributes"":[],""LogicalName"":""sdkmessageprocessingstep"",""Name"":null,""RowVersion"":null},""ParentContext"":{ ""BusinessUnitId"":""c3ec0cc2-d836-eb11-bf68-0022489b563d"",""CorrelationId"":""9d4c7524-a578-4783-b608-73f7b0b68fd2"",""Depth"":1,""InitiatingUserAzureActiveDirectoryObjectId"":""00000000-0000-0000-0000-000000000000"",""InitiatingUserId"":""a0bde583-0537-eb11-bf68-0022489b563d"",""InputParameters"":[{ ""key"":""Target"",""value"":{ ""__type"":""Entity:http:\/\/schemas.microsoft.com\/xrm\/2011\/Contracts"",""Attributes"":[{ ""key"":""albxrm_name"",""value"":""Test Betim""},{ ""key"":""albxrm_wholenumber"",""value"":987654321},{ ""key"":""albxrm_dateandtime"",""value"":""\/Date(1608015600000)\/""},{ ""key"":""albxrm_twooptions"",""value"":true},{ ""key"":""albxrm_float"",""value"":2365.12},{ ""key"":""albxrm_lookupaccount"",""value"":{ ""__type"":""EntityReference:http:\/\/schemas.microsoft.com\/xrm\/2011\/Contracts"",""Id"":""b76b3f4b-1be7-e611-8101-e0071b6af231"",""KeyAttributes"":[],""LogicalName"":""account"",""Name"":null,""RowVersion"":null} },{ ""key"":""albxrm_customer"",""value"":{ ""__type"":""EntityReference:http:\/\/schemas.microsoft.com\/xrm\/2011\/Contracts"",""Id"":""ad6b3f4b-1be7-e611-8101-e0071b6af231"",""KeyAttributes"":[],""LogicalName"":""account"",""Name"":null,""RowVersion"":null} },{ ""key"":""albxrm_multiplelinesoftext"",""value"":""sdafasf\u000aasdfas\u000aafsd""},{ ""key"":""albxrm_multiselectoptionset"",""value"":[{ ""__type"":""OptionSetValue:http:\/\/schemas.microsoft.com\/xrm\/2011\/Contracts"",""Value"":257760001},{ ""__type"":""OptionSetValue:http:\/\/schemas.microsoft.com\/xrm\/2011\/Contracts"",""Value"":257760002}]},{ ""key"":""albxrm_optionset"",""value"":{ ""__type"":""OptionSetValue:http:\/\/schemas.microsoft.com\/xrm\/2011\/Contracts"",""Value"":257760001} },{ ""key"":""albxrm_decimal"",""value"":10.01},{ ""key"":""albxrm_currency"",""value"":{ ""__type"":""Money:http:\/\/schemas.microsoft.com\/xrm\/2011\/Contracts"",""Value"":2154.32} },{ ""key"":""ownerid"",""value"":{ ""__type"":""EntityReference:http:\/\/schemas.microsoft.com\/xrm\/2011\/Contracts"",""Id"":""a0bde583-0537-eb11-bf68-0022489b563d"",""KeyAttributes"":[],""LogicalName"":""systemuser"",""Name"":null,""RowVersion"":null} },{ ""key"":""transactioncurrencyid"",""value"":{ ""__type"":""EntityReference:http:\/\/schemas.microsoft.com\/xrm\/2011\/Contracts"",""Id"":""083081e1-0737-eb11-bf68-0022489b563d"",""KeyAttributes"":[],""LogicalName"":""transactioncurrency"",""Name"":null,""RowVersion"":null} },{ ""key"":""statuscode"",""value"":{ ""__type"":""OptionSetValue:http:\/\/schemas.microsoft.com\/xrm\/2011\/Contracts"",""Value"":1} },{ ""key"":""albxrm_alltypesid"",""value"":""44bfc2a7-903e-eb11-a813-000d3ad9c2e1""}],""EntityState"":null,""FormattedValues"":[{ ""key"":""albxrm_wholenumber"",""value"":""987654321""},{ ""key"":""albxrm_twooptions"",""value"":""True""},{ ""key"":""albxrm_decimal"",""value"":""10.01""}],""Id"":""44bfc2a7-903e-eb11-a813-000d3ad9c2e1"",""KeyAttributes"":[],""LogicalName"":""albxrm_alltypes"",""RelatedEntities"":[],""RowVersion"":null} },{ ""key"":""SuppressDuplicateDetection"",""value"":false}],""IsExecutingOffline"":false,""IsInTransaction"":false,""IsOfflinePlayback"":false,""IsolationMode"":1,""MessageName"":""Create"",""Mode"":1,""OperationCreatedOn"":""\/Date(1608007658000+0000)\/"",""OperationId"":""45bfc2a7-903e-eb11-a813-000d3ad9c2e1"",""OrganizationId"":""0ba4ce62-d2d6-4681-bc25-b3bfb695d4d6"",""OrganizationName"":""0ba4ce62d2d64681bc25b3bfb695d4d6"",""OutputParameters"":[],""OwningExtension"":{ ""Id"":""2c28fe56-903e-eb11-a813-000d3ad9c2e1"",""KeyAttributes"":[],""LogicalName"":""sdkmessageprocessingstep"",""Name"":null,""RowVersion"":null},""ParentContext"":null,""PostEntityImages"":[],""PreEntityImages"":[],""PrimaryEntityId"":""44bfc2a7-903e-eb11-a813-000d3ad9c2e1"",""PrimaryEntityName"":""albxrm_alltypes"",""RequestId"":""3fab629b-b795-4834-a2ca-5a09b2cc6934"",""SecondaryEntityName"":""none"",""SharedVariables"":[{ ""key"":""IsAutoTransact"",""value"":true},{ ""key"":""DefaultsAddedFlag"",""value"":true}],""Stage"":30,""UserAzureActiveDirectoryObjectId"":""00000000-0000-0000-0000-000000000000"",""UserId"":""a0bde583-0537-eb11-bf68-0022489b563d""},""PostEntityImages"":[{""key"":""AsynchronousStepPrimaryName"",""value"":{""Attributes"":[{""key"":""albxrm_name"",""value"":""Test Betim""},{ ""key"":""albxrm_alltypesid"",""value"":""44bfc2a7-903e-eb11-a813-000d3ad9c2e1""}],""EntityState"":null,""FormattedValues"":[],""Id"":""44bfc2a7-903e-eb11-a813-000d3ad9c2e1"",""KeyAttributes"":[],""LogicalName"":""albxrm_alltypes"",""RelatedEntities"":[],""RowVersion"":null}}],""PreEntityImages"":[],""PrimaryEntityId"":""44bfc2a7-903e-eb11-a813-000d3ad9c2e1"",""PrimaryEntityName"":""albxrm_alltypes"",""RequestId"":""3fab629b-b795-4834-a2ca-5a09b2cc6934"",""SecondaryEntityName"":""none"",""SharedVariables"":[{""key"":""IsAutoTransact"",""value"":true},{ ""key"":""DefaultsAddedFlag"",""value"":true}],""Stage"":40,""UserAzureActiveDirectoryObjectId"":""00000000-0000-0000-0000-000000000000"",""UserId"":""a0bde583-0537-eb11-bf68-0022489b563d""}";
            var remoteExecutionContext = EntitySerializer.Deserialize<RemoteExecutionContext>(input);

            Assert.NotNull(remoteExecutionContext);
        }
    }
}
